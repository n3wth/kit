{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "dropdown",
  "title": "Dropdown",
  "description": "Accessible dropdown select with single/multi-select and search.",
  "dependencies": [
    "react-dom"
  ],
  "registryDependencies": [
    "cn"
  ],
  "files": [
    {
      "path": "registry/new-york/dropdown/dropdown.tsx",
      "content": "import {\n  forwardRef,\n  useState,\n  useRef,\n  useEffect,\n  useCallback,\n  useMemo,\n  useId,\n  createContext,\n  useContext,\n  type ReactNode,\n  type HTMLAttributes,\n  type KeyboardEvent,\n  type MouseEvent,\n} from 'react'\nimport { createPortal } from 'react-dom'\nimport { cn } from '@/lib/utils'\n\n/* ------------------------------------------------------------------\n   Types\n   ------------------------------------------------------------------ */\n\nexport interface DropdownOption {\n  value: string\n  label: string\n  disabled?: boolean\n}\n\nexport interface DropdownProps {\n  /** Options to display */\n  options: DropdownOption[]\n  /** Controlled value (single-select) */\n  value?: string\n  /** Controlled values (multi-select) */\n  values?: string[]\n  /** Default value for uncontrolled single-select */\n  defaultValue?: string\n  /** Default values for uncontrolled multi-select */\n  defaultValues?: string[]\n  /** Called when selection changes (single-select) */\n  onChange?: (value: string) => void\n  /** Called when selection changes (multi-select) */\n  onMultiChange?: (values: string[]) => void\n  /** Enable multi-select mode */\n  multi?: boolean\n  /** Enable search/filter input */\n  searchable?: boolean\n  /** Placeholder text when nothing is selected */\n  placeholder?: string\n  /** Search input placeholder */\n  searchPlaceholder?: string\n  /** Disabled state */\n  disabled?: boolean\n  /** Size variant */\n  size?: 'sm' | 'md' | 'lg'\n  /** Visual variant */\n  variant?: 'default' | 'glass'\n  /** Additional class names for the trigger */\n  className?: string\n  /** Additional class names for the menu */\n  menuClassName?: string\n  /** Use portal rendering for overflow contexts */\n  portal?: boolean\n  /** Children for compound API (overrides options-based rendering) */\n  children?: ReactNode\n}\n\n/* ------------------------------------------------------------------\n   Context for compound API\n   ------------------------------------------------------------------ */\n\ninterface DropdownContextValue {\n  isOpen: boolean\n  activeIndex: number\n  selectedValues: Set<string>\n  multi: boolean\n  listboxId: string\n  triggerId: string\n  toggle: () => void\n  close: () => void\n  select: (value: string) => void\n  setActiveIndex: (index: number) => void\n  registerItem: (value: string, index: number) => void\n}\n\nconst DropdownContext = createContext<DropdownContextValue | null>(null)\n\nfunction useDropdownContext() {\n  const ctx = useContext(DropdownContext)\n  if (!ctx) throw new Error('Dropdown compound components must be used within <Dropdown>')\n  return ctx\n}\n\n/* ------------------------------------------------------------------\n   Hooks\n   ------------------------------------------------------------------ */\n\nfunction useClickOutside(\n  refs: React.RefObject<HTMLElement | null>[],\n  handler: () => void\n) {\n  useEffect(() => {\n    function onPointerDown(e: PointerEvent) {\n      const target = e.target as Node\n      if (refs.every((r) => r.current && !r.current.contains(target))) {\n        handler()\n      }\n    }\n    document.addEventListener('pointerdown', onPointerDown)\n    return () => document.removeEventListener('pointerdown', onPointerDown)\n  }, [refs, handler])\n}\n\nfunction usePositioning(\n  triggerRef: React.RefObject<HTMLElement | null>,\n  isOpen: boolean\n) {\n  const [style, setStyle] = useState<React.CSSProperties>({})\n\n  useEffect(() => {\n    if (!isOpen || !triggerRef.current) return\n\n    function update() {\n      const trigger = triggerRef.current\n      if (!trigger) return\n      const rect = trigger.getBoundingClientRect()\n      setStyle({\n        position: 'fixed',\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: rect.width,\n        zIndex: 9999,\n      })\n    }\n\n    update()\n    window.addEventListener('scroll', update, true)\n    window.addEventListener('resize', update)\n    return () => {\n      window.removeEventListener('scroll', update, true)\n      window.removeEventListener('resize', update)\n    }\n  }, [isOpen, triggerRef])\n\n  return style\n}\n\n/* ------------------------------------------------------------------\n   Sub-components\n   ------------------------------------------------------------------ */\n\nexport interface DropdownTriggerProps extends HTMLAttributes<HTMLButtonElement> {\n  children?: ReactNode\n}\n\nexport const DropdownTrigger = forwardRef<HTMLButtonElement, DropdownTriggerProps>(\n  ({ children, className, onClick, ...props }, ref) => {\n    const ctx = useDropdownContext()\n\n    const handleClick = (e: MouseEvent<HTMLButtonElement>) => {\n      onClick?.(e)\n      ctx.toggle()\n    }\n\n    return (\n      <button\n        ref={ref}\n        id={ctx.triggerId}\n        type=\"button\"\n        role=\"combobox\"\n        aria-expanded={ctx.isOpen}\n        aria-haspopup=\"listbox\"\n        aria-controls={ctx.isOpen ? ctx.listboxId : undefined}\n        className={className}\n        onClick={handleClick}\n        {...props}\n      >\n        {children}\n      </button>\n    )\n  }\n)\nDropdownTrigger.displayName = 'Dropdown.Trigger'\n\nexport interface DropdownMenuProps extends HTMLAttributes<HTMLUListElement> {\n  children?: ReactNode\n}\n\nexport const DropdownMenu = forwardRef<HTMLUListElement, DropdownMenuProps>(\n  ({ children, className, ...props }, ref) => {\n    const ctx = useDropdownContext()\n\n    if (!ctx.isOpen) return null\n\n    return (\n      <ul\n        ref={ref}\n        id={ctx.listboxId}\n        role=\"listbox\"\n        aria-multiselectable={ctx.multi || undefined}\n        tabIndex={-1}\n        className={className}\n        {...props}\n      >\n        {children}\n      </ul>\n    )\n  }\n)\nDropdownMenu.displayName = 'Dropdown.Menu'\n\nexport interface DropdownItemProps extends HTMLAttributes<HTMLLIElement> {\n  value: string\n  disabled?: boolean\n  children?: ReactNode\n}\n\nexport const DropdownItem = forwardRef<HTMLLIElement, DropdownItemProps>(\n  ({ value, disabled = false, children, className, onClick, ...props }, ref) => {\n    const ctx = useDropdownContext()\n    const isSelected = ctx.selectedValues.has(value)\n\n    const handleClick = (e: MouseEvent<HTMLLIElement>) => {\n      if (disabled) return\n      onClick?.(e)\n      ctx.select(value)\n    }\n\n    return (\n      <li\n        ref={ref}\n        role=\"option\"\n        aria-selected={isSelected}\n        aria-disabled={disabled || undefined}\n        data-value={value}\n        className={className}\n        onClick={handleClick}\n        {...props}\n      >\n        {children ?? value}\n      </li>\n    )\n  }\n)\nDropdownItem.displayName = 'Dropdown.Item'\n\n/* ------------------------------------------------------------------\n   Chevron icon (inline SVG to avoid dependency)\n   ------------------------------------------------------------------ */\n\nfunction ChevronIcon({ open, className }: { open: boolean; className?: string }) {\n  return (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      className={cn(\n        'transition-transform duration-200 shrink-0',\n        open && 'rotate-180',\n        className\n      )}\n      aria-hidden=\"true\"\n    >\n      <path\n        d=\"M4 6L8 10L12 6\"\n        stroke=\"currentColor\"\n        strokeWidth=\"1.5\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n    </svg>\n  )\n}\n\nfunction SearchIcon() {\n  return (\n    <svg\n      width=\"14\"\n      height=\"14\"\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      className=\"shrink-0\"\n      aria-hidden=\"true\"\n    >\n      <circle cx=\"7\" cy=\"7\" r=\"5\" stroke=\"currentColor\" strokeWidth=\"1.5\" />\n      <path d=\"M11 11L14 14\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" />\n    </svg>\n  )\n}\n\nfunction CheckIcon() {\n  return (\n    <svg\n      width=\"14\"\n      height=\"14\"\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      className=\"shrink-0\"\n      aria-hidden=\"true\"\n    >\n      <path\n        d=\"M3.5 8.5L6.5 11.5L12.5 4.5\"\n        stroke=\"currentColor\"\n        strokeWidth=\"1.5\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n    </svg>\n  )\n}\n\n/* ------------------------------------------------------------------\n   Main Dropdown component\n   ------------------------------------------------------------------ */\n\nexport const Dropdown = Object.assign(\n  forwardRef<HTMLDivElement, DropdownProps>(\n    (\n      {\n        options = [],\n        value,\n        values,\n        defaultValue,\n        defaultValues,\n        onChange,\n        onMultiChange,\n        multi = false,\n        searchable = false,\n        placeholder = 'Select...',\n        searchPlaceholder = 'Search...',\n        disabled = false,\n        size = 'md',\n        variant = 'default',\n        className,\n        menuClassName,\n        portal = false,\n        children,\n      },\n      ref\n    ) => {\n      const uid = useId()\n      const triggerId = `dropdown-trigger-${uid}`\n      const listboxId = `dropdown-listbox-${uid}`\n\n      // State\n      const [isOpen, setIsOpen] = useState(false)\n      const [search, setSearch] = useState('')\n      const [activeIndex, setActiveIndex] = useState(-1)\n\n      // Selection state (controlled or uncontrolled)\n      const [internalValue, setInternalValue] = useState<string | undefined>(defaultValue)\n      const [internalValues, setInternalValues] = useState<string[]>(defaultValues ?? [])\n\n      const isControlled = multi ? values !== undefined : value !== undefined\n      const selectedValue = useMemo(\n        () => (isControlled ? value : internalValue),\n        [isControlled, value, internalValue]\n      )\n      const selectedMultiValues = useMemo(\n        () => (isControlled ? (values ?? []) : internalValues),\n        [isControlled, values, internalValues]\n      )\n      const selectedSet = useMemo(\n        () => new Set(multi ? selectedMultiValues : selectedValue ? [selectedValue] : []),\n        [multi, selectedMultiValues, selectedValue]\n      )\n\n      // Refs\n      const triggerRef = useRef<HTMLButtonElement>(null)\n      const menuRef = useRef<HTMLUListElement>(null)\n      const searchRef = useRef<HTMLInputElement>(null)\n      const containerRef = useRef<HTMLDivElement>(null)\n      const itemMapRef = useRef<Map<number, string>>(new Map())\n\n      // Filtered options\n      const filteredOptions = useMemo(() => {\n        if (!search) return options\n        const lower = search.toLowerCase()\n        return options.filter((o) => o.label.toLowerCase().includes(lower))\n      }, [options, search])\n\n      // Position for portal mode\n      const portalStyle = usePositioning(triggerRef, isOpen && portal)\n\n      // Close handler\n      const close = useCallback(() => {\n        setIsOpen(false)\n        setSearch('')\n        setActiveIndex(-1)\n        triggerRef.current?.focus()\n      }, [])\n\n      // Toggle\n      const toggle = useCallback(() => {\n        if (disabled) return\n        setIsOpen((prev) => {\n          if (prev) {\n            setSearch('')\n            setActiveIndex(-1)\n          }\n          return !prev\n        })\n      }, [disabled])\n\n      // Selection\n      const select = useCallback(\n        (val: string) => {\n          if (multi) {\n            const next = selectedSet.has(val)\n              ? selectedMultiValues.filter((v) => v !== val)\n              : [...selectedMultiValues, val]\n            if (!isControlled) setInternalValues(next)\n            onMultiChange?.(next)\n          } else {\n            if (!isControlled) setInternalValue(val)\n            onChange?.(val)\n            close()\n          }\n        },\n        [multi, selectedSet, selectedMultiValues, isControlled, onChange, onMultiChange, close]\n      )\n\n      // Register item (for compound API)\n      const registerItem = useCallback((val: string, index: number) => {\n        itemMapRef.current.set(index, val)\n      }, [])\n\n      // Click outside\n      useClickOutside([containerRef, menuRef], () => {\n        if (isOpen) close()\n      })\n\n      // Focus search input when menu opens\n      useEffect(() => {\n        if (isOpen && searchable) {\n          requestAnimationFrame(() => searchRef.current?.focus())\n        }\n      }, [isOpen, searchable])\n\n      // Keyboard handler\n      const handleKeyDown = useCallback(\n        (e: KeyboardEvent<HTMLDivElement>) => {\n          if (disabled) return\n\n          switch (e.key) {\n            case 'ArrowDown': {\n              e.preventDefault()\n              if (!isOpen) {\n                setIsOpen(true)\n                setActiveIndex(0)\n                return\n              }\n              setActiveIndex((prev) => {\n                const max = filteredOptions.length - 1\n                let next = prev + 1\n                while (next <= max && filteredOptions[next]?.disabled) next++\n                return next > max ? prev : next\n              })\n              break\n            }\n            case 'ArrowUp': {\n              e.preventDefault()\n              if (!isOpen) {\n                setIsOpen(true)\n                setActiveIndex(filteredOptions.length - 1)\n                return\n              }\n              setActiveIndex((prev) => {\n                let next = prev - 1\n                while (next >= 0 && filteredOptions[next]?.disabled) next--\n                return next < 0 ? prev : next\n              })\n              break\n            }\n            case 'Enter':\n            case ' ': {\n              if (!isOpen) {\n                e.preventDefault()\n                setIsOpen(true)\n                setActiveIndex(0)\n                return\n              }\n              // Allow space in search input\n              if (e.key === ' ' && searchable && document.activeElement === searchRef.current) {\n                return\n              }\n              e.preventDefault()\n              if (activeIndex >= 0 && filteredOptions[activeIndex] && !filteredOptions[activeIndex].disabled) {\n                select(filteredOptions[activeIndex].value)\n              }\n              break\n            }\n            case 'Escape': {\n              e.preventDefault()\n              close()\n              break\n            }\n            case 'Home': {\n              if (isOpen) {\n                e.preventDefault()\n                const first = filteredOptions.findIndex((o) => !o.disabled)\n                if (first >= 0) setActiveIndex(first)\n              }\n              break\n            }\n            case 'End': {\n              if (isOpen) {\n                e.preventDefault()\n                for (let i = filteredOptions.length - 1; i >= 0; i--) {\n                  if (!filteredOptions[i].disabled) {\n                    setActiveIndex(i)\n                    break\n                  }\n                }\n              }\n              break\n            }\n            case 'Tab': {\n              if (isOpen) close()\n              break\n            }\n            default: {\n              // Type-ahead: single character jumps to matching option\n              if (!searchable && e.key.length === 1 && !e.ctrlKey && !e.metaKey && !e.altKey) {\n                e.preventDefault()\n                if (!isOpen) setIsOpen(true)\n                const char = e.key.toLowerCase()\n                const startIndex = activeIndex + 1\n                const reordered = [\n                  ...filteredOptions.slice(startIndex),\n                  ...filteredOptions.slice(0, startIndex),\n                ]\n                const match = reordered.findIndex(\n                  (o) => !o.disabled && o.label.toLowerCase().startsWith(char)\n                )\n                if (match >= 0) {\n                  setActiveIndex((match + startIndex) % filteredOptions.length)\n                }\n              }\n            }\n          }\n        },\n        [disabled, isOpen, filteredOptions, activeIndex, searchable, select, close]\n      )\n\n      // Scroll active item into view\n      useEffect(() => {\n        if (!isOpen || activeIndex < 0 || !menuRef.current) return\n        const activeEl = menuRef.current.querySelector(`[data-index=\"${activeIndex}\"]`)\n        activeEl?.scrollIntoView({ block: 'nearest' })\n      }, [isOpen, activeIndex])\n\n      // Size styles\n      const triggerSizes = {\n        sm: 'h-8 px-3 text-xs',\n        md: 'h-10 px-4 text-sm',\n        lg: 'h-12 px-5 text-base',\n      }\n\n      const itemSizes = {\n        sm: 'px-3 py-1.5 text-xs',\n        md: 'px-4 py-2 text-sm',\n        lg: 'px-5 py-2.5 text-base',\n      }\n\n      // Variant styles\n      const triggerVariants = {\n        default: [\n          'bg-transparent',\n          'border-[var(--glass-border)]',\n          'hover:border-[var(--glass-highlight)]',\n        ],\n        glass: [\n          'bg-[var(--glass-bg)]',\n          'backdrop-blur-lg',\n          'border-[var(--glass-border)]',\n          'hover:bg-[rgba(255,255,255,0.08)]',\n        ],\n      }\n\n      // Display value\n      const displayValue = useMemo(() => {\n        if (multi) {\n          if (selectedMultiValues.length === 0) return null\n          const labels = selectedMultiValues\n            .map((v) => options.find((o) => o.value === v)?.label ?? v)\n          if (labels.length <= 2) return labels.join(', ')\n          return `${labels[0]}, ${labels[1]} +${labels.length - 2}`\n        }\n        if (!selectedValue) return null\n        return options.find((o) => o.value === selectedValue)?.label ?? selectedValue\n      }, [multi, selectedMultiValues, selectedValue, options])\n\n      // Active descendant\n      const activeDescendant =\n        isOpen && activeIndex >= 0\n          ? `${listboxId}-option-${activeIndex}`\n          : undefined\n\n      // Context value\n      const contextValue: DropdownContextValue = {\n        isOpen,\n        activeIndex,\n        selectedValues: selectedSet,\n        multi,\n        listboxId,\n        triggerId,\n        toggle,\n        close,\n        select,\n        setActiveIndex,\n        registerItem,\n      }\n\n      // If children are provided, use compound API\n      if (children) {\n        return (\n          <DropdownContext.Provider value={contextValue}>\n            <div ref={ref} onKeyDown={handleKeyDown}>\n              {children}\n            </div>\n          </DropdownContext.Provider>\n        )\n      }\n\n      // Options-based rendering\n      const menuContent = (\n        <ul\n          ref={menuRef}\n          id={listboxId}\n          role=\"listbox\"\n          aria-multiselectable={multi || undefined}\n          aria-label=\"Options\"\n          tabIndex={-1}\n          className={cn(\n            'py-1 max-h-60 overflow-y-auto',\n            'bg-[var(--glass-bg)] backdrop-blur-xl',\n            'border border-[var(--glass-border)]',\n            'rounded-xl',\n            'scrollbar-hidden',\n            'animate-in',\n            menuClassName\n          )}\n          style={portal ? portalStyle : undefined}\n        >\n          {searchable && (\n            <li role=\"presentation\" className=\"px-2 py-1.5 sticky top-0 bg-[var(--glass-bg)] backdrop-blur-xl z-10\">\n              <div className=\"flex items-center gap-2 px-2 py-1.5 rounded-lg border border-[var(--glass-border)] bg-transparent\">\n                <span className=\"text-[var(--color-grey-400)]\">\n                  <SearchIcon />\n                </span>\n                <input\n                  ref={searchRef}\n                  type=\"text\"\n                  role=\"searchbox\"\n                  aria-label=\"Filter options\"\n                  value={search}\n                  onChange={(e) => {\n                    setSearch(e.target.value)\n                    setActiveIndex(0)\n                  }}\n                  placeholder={searchPlaceholder}\n                  className={cn(\n                    'w-full bg-transparent',\n                    'text-[var(--color-white)]',\n                    'placeholder:text-[var(--color-grey-600)]',\n                    'focus:outline-none',\n                    'text-xs'\n                  )}\n                />\n              </div>\n            </li>\n          )}\n          {filteredOptions.length === 0 && (\n            <li\n              role=\"presentation\"\n              className=\"px-4 py-3 text-center text-xs text-[var(--color-grey-600)]\"\n            >\n              No options found\n            </li>\n          )}\n          {filteredOptions.map((option, index) => {\n            const isSelected = selectedSet.has(option.value)\n            const isActive = index === activeIndex\n\n            return (\n              <li\n                key={option.value}\n                id={`${listboxId}-option-${index}`}\n                role=\"option\"\n                aria-selected={isSelected}\n                aria-disabled={option.disabled || undefined}\n                data-index={index}\n                data-value={option.value}\n                className={cn(\n                  'flex items-center gap-2 cursor-pointer',\n                  'transition-[background-color,color] duration-150',\n                  itemSizes[size],\n                  isActive && 'bg-[var(--glass-highlight)]',\n                  isSelected && !isActive && 'text-[var(--color-white)]',\n                  !isSelected && !isActive && 'text-[var(--color-grey-300)]',\n                  option.disabled && 'opacity-40 cursor-not-allowed pointer-events-none',\n                  !option.disabled && !isActive && 'hover:bg-[var(--glass-bg)]'\n                )}\n                onClick={() => {\n                  if (!option.disabled) select(option.value)\n                }}\n                onMouseEnter={() => setActiveIndex(index)}\n              >\n                {multi && (\n                  <span\n                    className={cn(\n                      'w-4 h-4 rounded border flex items-center justify-center shrink-0',\n                      'transition-[background-color,border-color] duration-150',\n                      isSelected\n                        ? 'bg-[var(--color-white)] border-[var(--color-white)] text-[var(--color-bg)]'\n                        : 'border-[var(--glass-border)]'\n                    )}\n                  >\n                    {isSelected && <CheckIcon />}\n                  </span>\n                )}\n                <span className=\"truncate\">{option.label}</span>\n                {!multi && isSelected && (\n                  <span className=\"ml-auto text-[var(--color-white)]\">\n                    <CheckIcon />\n                  </span>\n                )}\n              </li>\n            )\n          })}\n        </ul>\n      )\n\n      return (\n        <div\n          ref={(node) => {\n            // Merge refs\n            ;(containerRef as React.MutableRefObject<HTMLDivElement | null>).current = node\n            if (typeof ref === 'function') ref(node)\n            else if (ref) (ref as React.MutableRefObject<HTMLDivElement | null>).current = node\n          }}\n          className=\"relative inline-block w-full\"\n          onKeyDown={handleKeyDown}\n        >\n          {/* Trigger */}\n          <button\n            ref={triggerRef}\n            id={triggerId}\n            type=\"button\"\n            role=\"combobox\"\n            aria-expanded={isOpen}\n            aria-haspopup=\"listbox\"\n            aria-controls={isOpen ? listboxId : undefined}\n            aria-activedescendant={activeDescendant}\n            disabled={disabled}\n            className={cn(\n              'w-full inline-flex items-center justify-between gap-2',\n              'border rounded-xl',\n              'transition-[border-color,background-color] duration-200',\n              'focus-ring',\n              'disabled:opacity-50 disabled:cursor-not-allowed',\n              triggerSizes[size],\n              triggerVariants[variant],\n              isOpen && 'border-[var(--color-white)]',\n              className\n            )}\n            onClick={toggle}\n          >\n            <span\n              className={cn(\n                'truncate text-left',\n                displayValue\n                  ? 'text-[var(--color-white)]'\n                  : 'text-[var(--color-grey-600)]'\n              )}\n            >\n              {displayValue ?? placeholder}\n            </span>\n            <ChevronIcon open={isOpen} className=\"text-[var(--color-grey-400)]\" />\n          </button>\n\n          {/* Menu */}\n          {isOpen && (\n            portal\n              ? createPortal(menuContent, document.body)\n              : <div className=\"absolute left-0 right-0 mt-1 z-50\">{menuContent}</div>\n          )}\n        </div>\n      )\n    }\n  ),\n  {\n    Trigger: DropdownTrigger,\n    Menu: DropdownMenu,\n    Item: DropdownItem,\n  }\n)\n\nDropdown.displayName = 'Dropdown'\n",
      "type": "registry:ui"
    }
  ],
  "type": "registry:ui"
}